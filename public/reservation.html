<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="src/css/reset.css">
    <link rel="stylesheet" href="src/css/reservation.css">
    <link rel="stylesheet" href="src/css/keep.css">
    <link rel="stylesheet" href="src/css/check.css">
    <link rel="stylesheet" href="src/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const supabase = window.supabase.createClient(
            "https://zgrjjnifqoactpuqolao.supabase.co",
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpncmpqbmlmcW9hY3RwdXFvbGFvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDEyNDc0NTgsImV4cCI6MjA1NjgyMzQ1OH0._Vl-6CRKdMjeDRyNoxlfect7sgusZ7L0N5OYu0a5hT0"
        );

        async function insertReservation() {
            const {
                data: {user},
            } = await supabase.auth.getUser();
            const userId = user?.id;

            const params = new URLSearchParams(window.location.search);
            const paymentKey = params.get("paymentKey");
            const orderId = params.get("orderId");
            const amount = params.get("amount");

            // await fetch("http://localhost:4000/toss/confirm", {
            //     method: "POST",
            //     headers: { "Content-Type": "application/json" },
            //     body: JSON.stringify({ paymentKey, orderId, amount })
            // });

            if (!paymentKey || !orderId || !amount) {
                // Swal.fire("í•„ìˆ˜ ê²°ì œ ì •ë³´ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.");
                return;
            }

            const reservationData = JSON.parse(localStorage.getItem("reservationData"));

            if (!reservationData) {
                // Swal.fire("ì´ë¯¸ ì˜ˆì•½ì´ ì²˜ë¦¬ë˜ì—ˆê±°ë‚˜, ì €ì¥ëœ ì˜ˆì•½ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            let insertResult;

            if (reservationData.delivery_start) {
                // ğŸšš ë°°ì†¡ ì˜ˆì•½ ì²˜ë¦¬
                insertResult = await supabase.from("delivery").insert([{
                    user_id: userId,
                    name: reservationData.name,
                    phone: reservationData.phone,
                    delivery_date: reservationData.delivery_date,
                    delivery_start: reservationData.delivery_start,
                    delivery_arrive: reservationData.delivery_arrive,
                    detail_adr: reservationData.detail_adr,
                    under: parseInt(reservationData.under) || 0,
                    over: parseInt(reservationData.over) || 0,
                    price: parseInt(reservationData.price) || 0,
                    // user_email: userEmail,
                    situation: "ì ‘ìˆ˜",
                }]);
            } else {
                // ğŸ“¦ ë³´ê´€ ì˜ˆì•½ ì²˜ë¦¬
                insertResult = await supabase.from("storage").insert([{
                    user_id: userId,
                    name: reservationData.name,
                    phone: reservationData.phone,
                    storage_start_date: reservationData.dateStart,
                    storage_end_date: reservationData.dateEnd,
                    location: reservationData.location,
                    small: parseInt(reservationData.small) || 0,
                    medium: parseInt(reservationData.medium) || 0,
                    large: parseInt(reservationData.large) || 0,
                    price: parseInt(reservationData.price) || 0,
                    // user_email: userEmail,
                    situation: "ì ‘ìˆ˜",
                }]);
            }

            const {error} = insertResult;

            localStorage.removeItem("reservationData");

            if (error) {
                console.error("ğŸ’¥ Supabase insert ì‹¤íŒ¨:", error);
                Swal.fire("ì˜¤ë¥˜", "ì˜ˆì•½ ì €ì¥ ì‹¤íŒ¨", "error");
            } else {

                sessionStorage.setItem("reservationSaved", "true");

                Swal.fire({
                    title: "ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!",
                    text: "í™ˆí˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.",
                    icon: "success",
                    showConfirmButton: true,
                })
            }
        }

        insertReservation(); // âœ… í˜¸ì¶œ

        function moveTop() {
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
    </script>

</head>

<body>
<div class="wrap">
    <div class="header">

    </div>
    <div class="contents">
        <div class="section1">
            <h1>TRIP WITH EASE</h1>
        </div>
        <div class="reservation_infor_container">
            <div class="reservation_infor">
                <div class="reservation_infor_text">
                    <h1>ê°„í¸í•œ ì˜ˆì•½, ìŠ¤ë§ˆíŠ¸í•œ ë³´ê´€</h1>
                    <p>ì§ ê±±ì • ì—†ì´ ë– ë‚˜ëŠ” ì™„ë²½í•œ í•˜ë£¨, ì§€ê¸ˆ ì˜ˆì•½í•˜ì„¸ìš”!</p>
                </div>
                <div class="reservation_infor_contents_container">
                    <div class="reservation_infor_contents" id="storReserve">

                        <div class="reservation_infor_contents_main">
                            <div class="reservation_infor_contents_main_section">
                                <div class="reservation_infor_contents_main_section_img">
                                    <img src="src/images/pay.svg" alt="">
                                </div>
                                <div class="reservation_infor_contents_main_section_text">
                                    <div class="index">
                                        1
                                    </div>
                                    <p>ë¹ ë¥¸ ë³´ê´€ê³¼ ê²°ì œ</p>
                                </div>
                            </div>
                            <div class="reservation_infor_contents_main_section">
                                <div class="reservation_infor_contents_main_section_img">
                                    <img src="src/images/keep.svg" alt="">
                                </div>
                                <div class="reservation_infor_contents_main_section_text">
                                    <div class="index">
                                        2
                                    </div>
                                    <p>ë³´ê´€ ë§¡ê¸°ê¸°</p>
                                </div>
                            </div>
                            <div class="reservation_infor_contents_main_section">
                                <div class="reservation_infor_contents_main_section_img">
                                    <img src="src/images/travel.svg" alt="">
                                </div>
                                <div class="reservation_infor_contents_main_section_text">
                                    <div class="index">
                                        3
                                    </div>
                                    <p>ì—¬í–‰ì˜ ì‹œì‘</p>
                                </div>
                            </div>
                        </div>
                        <div class="reservation_infor_contents_btn">
                            ë³´ê´€ ì˜ˆì•½
                        </div>
                    </div>
                    <div class="reservation_infor_contents" id="deliverReserve">
                        <div class="reservation_infor_contents_main">
                            <div class="reservation_infor_contents_main_section">
                                <div class="reservation_infor_contents_main_section_img">
                                    <img src="src/images/online_reserve.svg" alt="">
                                </div>
                                <div class="reservation_infor_contents_main_section_text">
                                    <div class="index">
                                        1
                                    </div>
                                    <p>ì˜¨ë¼ì¸ ë°°ì†¡ ì˜ˆì•½</p>
                                </div>
                            </div>
                            <div class="reservation_infor_contents_main_section">
                                <div class="reservation_infor_contents_main_section_img">
                                    <img src="src/images/delivery.svg" alt="">
                                </div>
                                <div class="reservation_infor_contents_main_section_text">
                                    <div class="index">
                                        2
                                    </div>
                                    <p>ë°°ì†¡ ë§¡ê¸°ê¸°</p>
                                </div>
                            </div>
                            <div class="reservation_infor_contents_main_section">
                                <div class="reservation_infor_contents_main_section_img">
                                    <img src="src/images/find.svg" alt="">
                                </div>
                                <div class="reservation_infor_contents_main_section_text">
                                    <div class="index">
                                        3
                                    </div>
                                    <p>ì§ì°¾ê¸°</p>
                                </div>
                            </div>
                        </div>
                        <div class="reservation_infor_contents_btn">
                            ë°°ì†¡ ì˜ˆì•½
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="section2">
            <div class="check_detail">
                <div class="check_detail_contents">

                </div>
                <div class="cancelBtn" style="transition-delay: 0.4s">

                </div>
            </div>
            <div class="check_container">
                <div class="check_contents">
                    <div class="check_contents_text">
                        <h1>ë³´ê´€/ë°°ì†¡ ë‚´ì—­ ì¡°íšŒ, ì‰½ê³  ë¹ ë¥´ê²Œ</h1>
                        <p>ë³´ê´€ ë‚´ì—­ê³¼ ë°°ì†¡ í˜„í™©ì„ í•œëˆˆì—! ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•˜ì„¸ìš”.</p>
                    </div>
                    <div class="change_btn_container">
                        <div class="change_btn">
                            <label class="keep_btn active">
                                <input type="checkbox" name="" class="keep_btn" id="keep_btn" style="display: none;"
                                       checked>
                                ë³´ê´€
                            </label>
                            <label class="delivery_btn">
                                <input type="checkbox" name="" class="delivery_btn" id="delivery_btn"
                                       style="display: none;">
                                ë°°ì†¡
                            </label>
                        </div>
                    </div>
                    <div class="view_table_container" style="display: block">

                        <div class="table_container">
                            <div class="storage_table">

                            </div>
                            <div class="delivery_table" style="display: block">

                            </div>
                        </div>
                        <div class="alert">
                            <h2 style="color: white">â€»ì˜ˆì•½ ë‚´ì—­ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.â€»</h2>
                        </div>

                    </div>
                    <div class="search_check" id="search_checkBox">
                        <!--                        <input type="text" name="" class="phone" id="search_reserveBox" placeholder="ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.">-->
                        <!--                        <button onclick="searchReserve()" class="search_check_btn">-->
                        <!--                            ê²€ìƒ‰-->
                        <!--                        </button>-->
                    </div>
                    <p style=" text-align: center; color: white; display: flex; justify-content: center; margin-top: 2rem; opacity: 0; transform: translateY(100%); animation: slideUp 0.5s forwards; animation-delay: 1.5s"
                       class="click_infor">â€» í´ë¦­í•˜ì‹œë©´ ìƒì„¸ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
        <div class="section3">
            <div class="keep_container">
                <div class="keep_contents">
                    <h1>í¸ë¦¬í•œ ë³´ê´€, ìŠ¤ë§ˆíŠ¸í•œ ì—¬í–‰</h1>
                    <p>ì§ ê±±ì • ì—†ì´ ê°€ë³ê²Œ ë– ë‚˜ê³ , ë¨¸ë¬´ëŠ” ê³³ì—ì„œë„ í¸í•˜ê²Œ ë³´ê´€í•˜ì„¸ìš”!</p>
                    <div class="keep_search">
                        <input type="text" name="search" id="storage_input" class="search" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.">
                        <i class="fa-solid fa-magnifying-glass search_img" id="storage_search"></i>
                    </div>
                    <div class="keep_adr_container">

                    </div>
                    <!--                <div class="keep_board_controler">-->
                    <!--                    <div class="keep_board_controler_btn">-->
                    <!--                        <p>1</p>-->
                    <!--                    </div>-->
                    <!--                    <div class="keep_board_controler_btn">-->
                    <!--                        <p>2</p>-->
                    <!--                    </div>-->
                    <!--                </div>-->
                </div>
            </div>
            <div class="keep_container">
                <div class="keep_contents">
                    <div class="keep_search">
                        <input type="text" name="search" id="partner_input" class="search" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.">
                        <i class="fa-solid fa-magnifying-glass search_img" id="partner_search"></i>
                    </div>
                    <div class="keep_adr_container">
                        <!--                        <div class="pagination_container">-->
                        <!--                            <button class="left">ì™¼ìª½</button>-->
                        <!--                            <button class="right">ì˜¤ë¥¸ìª½</button>-->
                        <!--                        </div>-->
                    </div>
                    <!--                <div class="keep_board_controler">-->
                    <!--                    <div class="keep_board_controler_btn">-->
                    <!--                        <p>1</p>-->
                    <!--                    </div>-->
                    <!--                    <div class="keep_board_controler_btn">-->
                    <!--                        <p>2</p>-->
                    <!--                    </div>-->
                    <!--                </div>-->
                </div>
            </div>
        </div>

    </div>
    <div class="footer">

    </div>
</div>
<script src="/storage_place.js"></script>
<script src="/partner_place.js"></script>
<script src="/dropdown.js"></script>
<script src="/change_btn.js"></script>
<script src="/check-re.js"></script>
</body>

</html>