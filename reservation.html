<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="src/css/reset.css">
    <link rel="stylesheet" href="src/css/reservation.css">
    <link rel="stylesheet" href="src/css/keep.css">
    <link rel="stylesheet" href="src/css/check.css">
    <link rel="stylesheet" href="src/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const supabase = window.supabase.createClient(
            "https://zgrjjnifqoactpuqolao.supabase.co",
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpncmpqbmlmcW9hY3RwdXFvbGFvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDEyNDc0NTgsImV4cCI6MjA1NjgyMzQ1OH0._Vl-6CRKdMjeDRyNoxlfect7sgusZ7L0N5OYu0a5hT0"
        );

        async function insertReservation() {
            const params = new URLSearchParams(window.location.search);
            const paymentKey = params.get("paymentKey");
            const orderId = params.get("orderId");
            const amount = params.get("amount");

            await fetch("http://localhost:4000/toss/confirm", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ paymentKey, orderId, amount })
            });

            if (!paymentKey || !orderId || !amount) return;

            const reservationData = JSON.parse(localStorage.getItem("reservationData"));

            if (!reservationData) {
                Swal.fire("Ïò§Î•ò", "Ï†ÄÏû•Îêú ÏòàÏïΩ Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.", "error");
                return;
            }

            let insertResult;

            if (reservationData.delivery_start) {
                // üöö Î∞∞ÏÜ° ÏòàÏïΩ Ï≤òÎ¶¨
                insertResult = await supabase.from("delivery").insert([{
                    name: reservationData.name,
                    phone: reservationData.phone,
                    delivery_date: reservationData.delivery_date,
                    delivery_start: reservationData.delivery_start,
                    delivery_arrive: reservationData.delivery_arrive,
                    detail_adr: reservationData.detail_adr,
                    under: parseInt(reservationData.under) || 0,
                    over: parseInt(reservationData.over) || 0,
                    price: parseInt(reservationData.price) || 0,
                    user_email: userEmail
                }]);
            } else {
                // üì¶ Î≥¥Í¥Ä ÏòàÏïΩ Ï≤òÎ¶¨
                insertResult = await supabase.from("storage").insert([{
                    name: reservationData.name,
                    phone: reservationData.phone,
                    storage_start_date: reservationData.dateStart,
                    storage_end_date: reservationData.dateEnd,
                    location: reservationData.location,
                    small: parseInt(reservationData.small) || 0,
                    medium: parseInt(reservationData.medium) || 0,
                    large: parseInt(reservationData.large) || 0,
                    price: parseInt(reservationData.price) || 0,
                    user_email: userEmail
                }]);
            }

            const { error } = insertResult;

            if (error) {
                console.error("üí• Supabase insert Ïã§Ìå®:", error);
                Swal.fire("Ïò§Î•ò", "ÏòàÏïΩ Ï†ÄÏû• Ïã§Ìå®", "error");
            } else {
                Swal.fire({
                    title: "ÏòàÏïΩÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!",
                    text: "ÌôàÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.",
                    icon: "success",
                    timer: 2000,
                    showConfirmButton: false,
                    didClose: () => {
                        localStorage.removeItem("reservationData");
                        window.location.href = "reservation.html";
                    }
                });
            }
        }

        insertReservation(); // ‚úÖ Ìò∏Ï∂ú
    </script>

</head>

<body>
<div class="wrap">
    <div class="header">

    </div>
    <div class="contents">
        <div class="section1">
            <h1>TRIP WITH EASE</h1>
        </div>
        <div class="reservation_infor_container">
            <div class="reservation_infor">
                <div class="reservation_infor_text">
                    <h1>Í∞ÑÌé∏Ìïú ÏòàÏïΩ, Ïä§ÎßàÌä∏Ìïú Î≥¥Í¥Ä</h1>
                    <p>Ïßê Í±±Ï†ï ÏóÜÏù¥ Îñ†ÎÇòÎäî ÏôÑÎ≤ΩÌïú ÌïòÎ£®, ÏßÄÍ∏à ÏòàÏïΩÌïòÏÑ∏Ïöî!</p>
                </div>
                <div class="reservation_infor_contents_container">
                    <div class="reservation_infor_contents" id="storReserve">

                        <div class="reservation_infor_contents_main">
                            <div class="reservation_infor_contents_main_section">
                                <div class="reservation_infor_contents_main_section_img">
                                    <img src="src/images/pay.svg" alt="">
                                </div>
                                <div class="reservation_infor_contents_main_section_text">
                                    <div class="index">
                                        1
                                    </div>
                                    <p>Îπ†Î•∏ Î≥¥Í¥ÄÍ≥º Í≤∞Ï†ú</p>
                                </div>
                            </div>
                            <div class="reservation_infor_contents_main_section">
                                <div class="reservation_infor_contents_main_section_img">
                                    <img src="src/images/keep.svg" alt="">
                                </div>
                                <div class="reservation_infor_contents_main_section_text">
                                    <div class="index">
                                        2
                                    </div>
                                    <p>Î≥¥Í¥Ä Îß°Í∏∞Í∏∞</p>
                                </div>
                            </div>
                            <div class="reservation_infor_contents_main_section">
                                <div class="reservation_infor_contents_main_section_img">
                                    <img src="src/images/travel.svg" alt="">
                                </div>
                                <div class="reservation_infor_contents_main_section_text">
                                    <div class="index">
                                        3
                                    </div>
                                    <p>Ïó¨ÌñâÏùò ÏãúÏûë</p>
                                </div>
                            </div>
                        </div>
                        <div class="reservation_infor_contents_btn">
                            Î≥¥Í¥Ä ÏòàÏïΩ
                        </div>
                    </div>
                    <div class="reservation_infor_contents" id="deliverReserve">
                        <div class="reservation_infor_contents_main">
                            <div class="reservation_infor_contents_main_section">
                                <div class="reservation_infor_contents_main_section_img">
                                    <img src="src/images/online_reserve.svg" alt="">
                                </div>
                                <div class="reservation_infor_contents_main_section_text">
                                    <div class="index">
                                        1
                                    </div>
                                    <p>Ïò®ÎùºÏù∏ Î∞∞ÏÜ° ÏòàÏïΩ</p>
                                </div>
                            </div>
                            <div class="reservation_infor_contents_main_section">
                                <div class="reservation_infor_contents_main_section_img">
                                    <img src="src/images/delivery.svg" alt="">
                                </div>
                                <div class="reservation_infor_contents_main_section_text">
                                    <div class="index">
                                        2
                                    </div>
                                    <p>Î∞∞ÏÜ° Îß°Í∏∞Í∏∞</p>
                                </div>
                            </div>
                            <div class="reservation_infor_contents_main_section">
                                <div class="reservation_infor_contents_main_section_img">
                                    <img src="src/images/find.svg" alt="">
                                </div>
                                <div class="reservation_infor_contents_main_section_text">
                                    <div class="index">
                                        3
                                    </div>
                                    <p>ÏßêÏ∞æÍ∏∞</p>
                                </div>
                            </div>
                        </div>
                        <div class="reservation_infor_contents_btn">
                            Î∞∞ÏÜ° ÏòàÏïΩ
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="section2">
            <div class="check_detail">
                <div class="check_detail_contents">

                </div>
                <div class="cancelBtn" style="transition-delay: 0.4s">

                </div>
            </div>
            <div class="check_container">
                <div class="check_contents">
                    <div class="check_contents_text">
                        <h1>Î≥¥Í¥Ä/Î∞∞ÏÜ° ÎÇ¥Ïó≠ Ï°∞Ìöå, ÏâΩÍ≥† Îπ†Î•¥Í≤å</h1>
                        <p>Î≥¥Í¥Ä ÎÇ¥Ïó≠Í≥º Î∞∞ÏÜ° ÌòÑÌô©ÏùÑ ÌïúÎààÏóê! Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÌôïÏù∏ÌïòÏÑ∏Ïöî.</p>
                    </div>
                    <div class="change_btn_container">
                        <div class="change_btn">
                            <label class="keep_btn active">
                                <input type="checkbox" name="" class="keep_btn" id="keep_btn" style="display: none;"
                                       checked>
                                Î≥¥Í¥Ä
                            </label>
                            <label class="delivery_btn">
                                <input type="checkbox" name="" class="delivery_btn" id="delivery_btn"
                                       style="display: none;">
                                Î∞∞ÏÜ°
                            </label>
                        </div>
                    </div>
                    <div class="view_table_container" style="display: block">

                        <div class="table_container">
                            <div class="storage_table">

                            </div>
                            <div class="delivery_table" style="display: block">

                            </div>
                        </div>
                        <div class="alert">
                            <h2 style="color: white">‚ÄªÏòàÏïΩ ÎÇ¥Ïó≠Ïù¥ Ï°¥Ïû¨ÌïòÏßÄ ÏïäÏäµÎãàÎã§.‚Äª</h2>
                        </div>

                    </div>
                    <div class="search_check" id="search_checkBox">
<!--                        <input type="text" name="" class="phone" id="search_reserveBox" placeholder="Ïó∞ÎùΩÏ≤òÎ•º ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî.">-->
<!--                        <button onclick="searchReserve()" class="search_check_btn">-->
<!--                            Í≤ÄÏÉâ-->
<!--                        </button>-->
                    </div>
                    <p style=" text-align: center; color: white; display: flex; justify-content: center; margin-top: 2rem; opacity: 0; transform: translateY(100%); animation: slideUp 0.5s forwards; animation-delay: 1.5s"
                       class="click_infor">‚Äª ÌÅ¥Î¶≠ÌïòÏãúÎ©¥ ÏÉÅÏÑ∏Ï†ïÎ≥¥Î•º Î≥º Ïàò ÏûàÏäµÎãàÎã§.</p>
                </div>
            </div>
        </div>
        <div class="section3">
            <div class="keep_container">
                <div class="keep_contents">
                    <h1>Ìé∏Î¶¨Ìïú Î≥¥Í¥Ä, Ïä§ÎßàÌä∏Ìïú Ïó¨Ìñâ</h1>
                    <p>Ïßê Í±±Ï†ï ÏóÜÏù¥ Í∞ÄÎ≥çÍ≤å Îñ†ÎÇòÍ≥†, Î®∏Î¨¥Îäî Í≥≥ÏóêÏÑúÎèÑ Ìé∏ÌïòÍ≤å Î≥¥Í¥ÄÌïòÏÑ∏Ïöî!</p>
                    <div class="keep_search">
                        <input type="text" name="search" id="storage_input" class="search" placeholder="Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.">
                        <i class="fa-solid fa-magnifying-glass search_img" id="storage_search"></i>
                    </div>
                    <div class="keep_adr_container">

                    </div>
                    <!--                <div class="keep_board_controler">-->
                    <!--                    <div class="keep_board_controler_btn">-->
                    <!--                        <p>1</p>-->
                    <!--                    </div>-->
                    <!--                    <div class="keep_board_controler_btn">-->
                    <!--                        <p>2</p>-->
                    <!--                    </div>-->
                    <!--                </div>-->
                </div>
            </div>
            <div class="keep_container">
                <div class="keep_contents">
                    <div class="keep_search">
                        <input type="text" name="search" id="partner_input" class="search" placeholder="Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.">
                        <i class="fa-solid fa-magnifying-glass search_img" id="partner_search"></i>
                    </div>
                    <div class="keep_adr_container">
                        <!--                        <div class="pagination_container">-->
                        <!--                            <button class="left">ÏôºÏ™Ω</button>-->
                        <!--                            <button class="right">Ïò§Î•∏Ï™Ω</button>-->
                        <!--                        </div>-->
                    </div>
                    <!--                <div class="keep_board_controler">-->
                    <!--                    <div class="keep_board_controler_btn">-->
                    <!--                        <p>1</p>-->
                    <!--                    </div>-->
                    <!--                    <div class="keep_board_controler_btn">-->
                    <!--                        <p>2</p>-->
                    <!--                    </div>-->
                    <!--                </div>-->
                </div>
            </div>
        </div>

    </div>
    <div class="footer">

    </div>
</div>
<script src="storage_place.js"></script>
<script src="partner_place.js"></script>
<script src="dropdown.js"></script>
<script src="change_btn.js"></script>
<script src="check-re.js"></script>
</body>

</html>